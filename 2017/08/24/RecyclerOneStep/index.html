<!DOCTYPE html>
<html lang="zh">
    <head>
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.4 -->

    <!-- Title -->
    
    <title>
        
            RecyclerView进阶（一）通过装饰者模式添加头部底部 | 
        
        我的博客
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="孙俊卿">
    <meta name="description" content="记录生活点滴">
    <meta name="keywords" content="android">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="我的博客">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://livesun.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="RecyclerView进阶（一）通过装饰者模式添加头部底部 | 我的博客">
    <meta property="og:description" content="记录生活点滴">
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
<link rel="stylesheet" href="/css/prism-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#通过装饰者模式添加头部底部"><span class="post-toc-number">1.</span> <span class="post-toc-text">通过装饰者模式添加头部底部</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                RecyclerView进阶（一）通过装饰者模式添加头部底部
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>孙俊卿</strong>
        <span>8月 24, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=RecyclerView进阶（一）通过装饰者模式添加头部底部&url=http://livesun.github.io//2017/08/24/RecyclerOneStep/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=RecyclerView进阶（一）通过装饰者模式添加头部底部&url=http://livesun.github.io//2017/08/24/RecyclerOneStep/index.html&via=孙俊卿" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://livesun.github.io//2017/08/24/RecyclerOneStep/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://livesun.github.io//2017/08/24/RecyclerOneStep/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=我的博客&title=RecyclerView进阶（一）通过装饰者模式添加头部底部&summary=记录生活点滴&pics=http://livesun.github.io/img/favicon.png&url=http://livesun.github.io/2017/08/24/RecyclerOneStep/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h3 id="通过装饰者模式添加头部底部"><a href="#通过装饰者模式添加头部底部" class="headerlink" title="通过装饰者模式添加头部底部"></a>通过装饰者模式添加头部底部</h3><p>ListView提供了addHeadView和addFootView方法，使用起来非常方便，而ReyclerView则需要我们自己在adapter中判断，常规做法无外乎判断position==0，来添加头布局，不过这个做法只适合单个，而且不通用。</p>
<p>我们看下ListView.addHeadView是如何实现的</p>
<p><img src="http://livesunhexo.oss-cn-shanghai.aliyuncs.com/hexo/viewTouch/recycler_warpperhead.gif" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public void addHeaderView(View v, Object data, boolean isSelectable) &#123;</div><div class="line">        final FixedViewInfo info = new FixedViewInfo();</div><div class="line">        info.view = v;</div><div class="line">        info.data = data;</div><div class="line">        info.isSelectable = isSelectable;</div><div class="line">        mHeaderViewInfos.add(info);</div><div class="line">        mAreAllItemsSelectable &amp;= isSelectable;</div><div class="line"></div><div class="line">       </div><div class="line">        if (mAdapter != null) &#123;</div><div class="line">            if (!(mAdapter instanceof HeaderViewListAdapter)) &#123;</div><div class="line">                mAdapter = new HeaderViewListAdapter(mHeaderViewInfos, mFooterViewInfos, mAdapter);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            </div><div class="line">            if (mDataSetObserver != null) &#123;</div><div class="line">                mDataSetObserver.onChanged();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>这里 mAdapter = new HeaderViewListAdapter(mHeaderViewInfos,mFooterViewInfos, mAdapter)，new 了一个新的adapter，并把当前的adapter传进去了，这里其实采用的装饰者模式来做的，照着他的源码做一个试试。</p>
<p>1、创建WrapperHeadAndFootAdapter继承成RecylcerView.Adapter，同时，创建头部集合和底部集合，添加集合和移除集合方法。</p>
<p>这里采用SparseArray 取代HashMap 原因有两点：</p>
<ul>
<li>SparseArray默认以int为key，少了拆箱装箱流程</li>
<li>在千量级，性能优于HashMap，并且更轻量,更省内存。</li>
</ul>
<p>可以看看这篇 –&gt; <a href="http://note.youdao.com/" target="_blank" rel="external">Android内存优化–SparseArray和ArrayMap</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line">public class WrapperHeadAndFootAdapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; &#123;</div><div class="line"></div><div class="line">    //头布局集合</div><div class="line">    public SparseArray&lt;View&gt; mHeads =new SparseArray&lt;&gt;();</div><div class="line">    //底布局集合</div><div class="line">    public SparseArray&lt;View&gt; mFoots =new SparseArray&lt;&gt;();</div><div class="line">    //被装饰的Adapter</div><div class="line">    public RecyclerView.Adapter mAdapter;</div><div class="line">    //头部集合的key</div><div class="line">    public static int HEAD_KEY=1000000;</div><div class="line">    //底部集合的key</div><div class="line">    public static int FOOT_KEY=3000000;</div><div class="line"></div><div class="line"> public  WrapperHeadAndFootAdapter(RecyclerView.Adapter adapter)&#123;</div><div class="line">       </div><div class="line">        if(adapter==null)&#123;</div><div class="line">            throw new IllegalArgumentException(&quot;adapter cannot null&quot;);</div><div class="line">        &#125;</div><div class="line">         mAdapter=adapter;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">     @Override</div><div class="line">    public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</div><div class="line">      </div><div class="line">            return null;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) &#123;</div><div class="line">       </div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    public int getItemCount() &#123;</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">       /**</div><div class="line">     * 添加头布局</div><div class="line">     */</div><div class="line"></div><div class="line">    public void addHeadView(View view)&#123;</div><div class="line">        if(mHeads.indexOfValue(view)==-1)&#123;</div><div class="line">            mHeads.put(HEAD_KEY++,view);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    /**</div><div class="line">     * 移除头布局</div><div class="line">     */</div><div class="line"></div><div class="line">    public void removeHeadView(View view)&#123;</div><div class="line">       removeHeadView(view,-1);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 移除头布局</div><div class="line">     */</div><div class="line"></div><div class="line">    public void removeHeadView(View view,int posistion)&#123;</div><div class="line">        int index = mHeads.indexOfValue(view);</div><div class="line">        if(index &gt;=0)&#123;</div><div class="line">            mHeads.removeAt(index);</div><div class="line">        &#125;</div><div class="line">        notifyItemRemoved(posistion);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 添加底布局</div><div class="line">     */</div><div class="line"></div><div class="line">    public void addFootView(View view)&#123;</div><div class="line"></div><div class="line">        if(mFoots.indexOfValue(view)==-1)&#123;</div><div class="line">            mFoots.put(FOOT_KEY++,view);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 删除底布局</div><div class="line">     */</div><div class="line"></div><div class="line">    public void removeFootView(View view)&#123;</div><div class="line">        removeFootView(view,-1);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 删除底布局</div><div class="line">     */</div><div class="line"></div><div class="line">    public void removeFootView(View view,int position)&#123;</div><div class="line">        int index = mFoots.indexOfValue(view);</div><div class="line">        if(index&gt;0)&#123;</div><div class="line">            mFoots.removeAt(index);</div><div class="line">        &#125;</div><div class="line">        notifyItemRemoved(position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里，可能有疑问为什么mHeads和mFoots的key取值分别为100000和300000，其实这里不一定非要是这个，你也可以是0或者负数，但是这里面有个问题，当在getItemViewType中，返回key的时候，假如是0，而我们的mAdapter的默认返回值就是0，那在onCreateViewHolder中就会产生冲突，尤其是多布局的情况下，viewType的值并不确定，所以保险起见，弄了一个这个值，这个值随意，只要保证不冲突即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line"> public RecyclerView.ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</div><div class="line">     //头布局--viewType是mHeads的key</div><div class="line">     if (mHeads.indexOfKey(viewType)&gt;=0)&#123;</div><div class="line">         return new RecyclerView.ViewHolder(mHeads.get(viewType)) &#123;</div><div class="line">         &#125;;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     if(mFoots.indexOfKey(viewType)&gt;=0)&#123;</div><div class="line">         return new RecyclerView.ViewHolder(mFoots.get(viewType)) &#123;</div><div class="line">         &#125;;</div><div class="line">     &#125;</div><div class="line">         return mAdapter.onCreateViewHolder(parent,viewType);</div><div class="line"></div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"> @Override</div><div class="line"> public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) &#123;</div><div class="line">     int normlPosition= position - mHeads.size();</div><div class="line">     int itemCount = mAdapter.getItemCount();</div><div class="line"> </div><div class="line">     if(isHeadView(position))&#123;</div><div class="line">         //如果是头部，不绑定</div><div class="line">              if(onHeadClickListener!=null)&#123;</div><div class="line">              //设置头部的点击事件</div><div class="line">             final View headView = mHeads.get(mHeads.keyAt(position));</div><div class="line">             if(headView!=null)&#123;</div><div class="line">                 headView.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">                     @Override</div><div class="line">                     public void onClick(View v) &#123;</div><div class="line">                         onHeadClickListener.onClick(headView,getHeadPosition(headView));</div><div class="line">                     &#125;</div><div class="line">                 &#125;);</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line">         </div><div class="line">         return;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     if(isFootView(position))&#123;</div><div class="line">         //如果是底部，不绑定</div><div class="line">         if(onFootClickListener!=null)&#123;</div><div class="line">         //设置底部点击事件</div><div class="line">             final View footView = mFoots.get(mFoots.keyAt(normlPosition-itemCount));</div><div class="line">             if(footView!=null)&#123;</div><div class="line">                 footView.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">                     @Override</div><div class="line">                     public void onClick(View v) &#123;</div><div class="line">                         onFootClickListener.onClick(footView,getHeadPosition(footView));</div><div class="line">                     &#125;</div><div class="line">                 &#125;);</div><div class="line">             &#125;</div><div class="line">         return;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     //正常布局</div><div class="line">     </div><div class="line">     if(normlPosition&lt;itemCount)&#123;</div><div class="line">         mAdapter.onBindViewHolder(holder,normlPosition);</div><div class="line">     &#125;</div><div class="line"></div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"> @Override</div><div class="line"> public int getItemCount() &#123;</div><div class="line">     return mHeads.size()+mAdapter.getItemCount()+mFoots.size();</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> @Override</div><div class="line"> public int getItemViewType(int position) &#123;</div><div class="line">     //头布局</div><div class="line">     if(isHeadView(position))&#123;</div><div class="line">         return mHeads.keyAt(position);</div><div class="line">     &#125;</div><div class="line">     //正常列表</div><div class="line">     int normlPosition=position-mHeads.size();</div><div class="line">     int itemCount = mAdapter.getItemCount();</div><div class="line">     if(normlPosition&lt;itemCount)&#123;</div><div class="line"></div><div class="line">         return mAdapter.getItemViewType(normlPosition);</div><div class="line">     &#125;</div><div class="line">     //底布局</div><div class="line">     int footPosition=normlPosition-itemCount;</div><div class="line">     return mFoots.keyAt(footPosition);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"> private boolean isFootView(int position)&#123;</div><div class="line"></div><div class="line">     return position&gt;=mHeads.size()+mAdapter.getItemCount();</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> private boolean isHeadView(int position)&#123;</div><div class="line">     int size = mHeads.size();</div><div class="line">     return position&lt;size;</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> </div><div class="line">  /**</div><div class="line">  * 设置头部的点击事件</div><div class="line">  * @param onHeadClickListener</div><div class="line">  */</div><div class="line"> public void setOnHeadClickListener(OnHeadClickListener onHeadClickListener)&#123;</div><div class="line"></div><div class="line">     this.onHeadClickListener = onHeadClickListener;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> /**</div><div class="line">  * 设置底部的点击事件</div><div class="line">  */</div><div class="line"></div><div class="line"> public void setOnFootClickListener(OnFootClickListener onFootClickListener)&#123;</div><div class="line"></div><div class="line">     this.onFootClickListener = onFootClickListener;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> /**</div><div class="line">  * 解决GridLayoutManager添加头部和底部不占用一行的问题</div><div class="line">  */</div><div class="line"> public void adjustSpanSize(RecyclerView recycler) &#123;</div><div class="line">     if (recycler.getLayoutManager() instanceof GridLayoutManager) &#123;</div><div class="line">         final GridLayoutManager layoutManager = (GridLayoutManager) recycler.getLayoutManager();</div><div class="line">         layoutManager.setSpanSizeLookup(new GridLayoutManager.SpanSizeLookup() &#123;</div><div class="line">             @Override</div><div class="line">             public int getSpanSize(int position) &#123;</div><div class="line">                 boolean isHeaderOrFooter = isHeaderPosition(position) || isFooterPosition(position);</div><div class="line">                 return isHeaderOrFooter ? layoutManager.getSpanCount() : 1;</div><div class="line">             &#125;</div><div class="line">         &#125;);</div><div class="line">     &#125;</div><div class="line"> &#125;</div><div class="line"> </div><div class="line">  /**</div><div class="line">  * 获取头部的位置</div><div class="line">  * @param view</div><div class="line">  * @return</div><div class="line">  */</div><div class="line"> public int getHeadPosition(View view) &#123;</div><div class="line">     return  mHeads.indexOfValue(view);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> /**</div><div class="line">  * 获取底部的位置</div><div class="line">  */</div><div class="line"></div><div class="line"> public int getFootPosition(View view)&#123;</div><div class="line">     int position=mFoots.indexOfValue(view)+mHeads.size()+mAdapter.getItemCount();</div><div class="line">     return position;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>上面代码 其实没什么好注意的，唯一注意的是在onBindViewHolder绑定数据的时候，如果是头布局或者底布局要记得return,否则会爆空指针异常。</p>
<p>下面是头部和底部点击的监听<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public interface OnFootClickListener &#123;</div><div class="line">    void onClick(View view, int position);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public interface OnHeadClickListener &#123;</div><div class="line">    void onClick(View view, int position);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">RecyclerView recyclerView = (RecyclerView) findViewById(R.id.recyclerView);</div><div class="line"></div><div class="line"></div><div class="line"> findViewById(R.id.chose).setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                if(!chose)&#123;</div><div class="line">                    chose=!chose;</div><div class="line">                    recyclerView.setLayoutManager(new GridLayoutManager(TestActivity1.this,2));</div><div class="line">                    recyclerView.getAdapter().notifyDataSetChanged();</div><div class="line">                    wrapperAdapter.spanSize(recyclerView);</div><div class="line">                &#125;else&#123;</div><div class="line">                    chose=!chose;</div><div class="line">                    recyclerView.setLayoutManager(new LinearLayoutManager(TestActivity1.this));</div><div class="line">                    recyclerView.getAdapter().notifyDataSetChanged();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        recyclerView.setLayoutManager(new LinearLayoutManager(this));</div><div class="line">        //原始adapter</div><div class="line">        MyAdapter dapter = new MyAdapter(getDatas(), this);</div><div class="line">        //wrapper</div><div class="line">        wrapperAdapter = new WrapperHeadAndFootAdapter(dapter);</div><div class="line">        LayoutInflater layoutInflater = LayoutInflater.from(this);</div><div class="line">        recyclerView.setAdapter(wrapperAdapter);</div><div class="line"></div><div class="line">        wrapperAdapter.addHeadView(layoutInflater.inflate(R.layout.head_view,recyclerView,false));</div><div class="line">        wrapperAdapter.addHeadView(layoutInflater.inflate(R.layout.head_view,recyclerView,false));</div><div class="line">        wrapperAdapter.addFootView(layoutInflater.inflate(R.layout.head_view,recyclerView,false));</div><div class="line">        wrapperAdapter.addFootView(layoutInflater.inflate(R.layout.head_view,recyclerView,false));</div><div class="line">        //原始adapter的条目点击事件</div><div class="line">        dapter.setOnItemClickListener(new OnItemClickListener&lt;CharBean&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public void onItem(int position, CharBean charBean) &#123;</div><div class="line">                Toast.makeText(TestActivity1.this,charBean.getSrc(),Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        //底部监听事件</div><div class="line">        wrapperAdapter.setOnFootClickListener(new OnFootClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View view, int position) &#123;</div><div class="line">                wrapperAdapter.removeFootView(view,position);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        //头部监听事件</div><div class="line">        wrapperAdapter.setOnHeadClickListener(new OnHeadClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View view, int position) &#123;</div><div class="line">                wrapperAdapter.removeHeadView(view,position);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>这样当然有点麻烦，我们可以封装成一个WrapperRecyclerView，例如这样</p>
<p>就可以欢快的调用了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">   public void setAdapter(Adapter adapter) &#123;</div><div class="line">       if (mAdapter != null) &#123;</div><div class="line">           mAdapter.unregisterAdapterDataObserver(mDataObserver);</div><div class="line">           mAdapter = null;</div><div class="line">       &#125;</div><div class="line">       mAdapter = adapter;</div><div class="line">       mAdapter.notifyDataSetChanged();</div><div class="line">       mWrapperAdapter = new WrapperHeadAndFootAdapter(adapter,mHeads,mFoots);</div><div class="line">       super.setAdapter(mWrapperAdapter);</div><div class="line">       //适配GridLayoutManager</div><div class="line">       mWrapperAdapter.spanSize(this);</div><div class="line">       //注册监听器</div><div class="line">       mWrapperAdapter.registerAdapterDataObserver(mDataObserver);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    







                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/08/14/ViewTouchCombat/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="孙俊卿's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        290287491@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto: 290287491@qq.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">9</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Android架构/">Android架构<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/常用控件/">常用控件<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/源码分析/">源码分析<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/categories/自定义View/">自定义View<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/自定义view/">自定义view<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/设计模式/">设计模式<span class="sidebar_archives-count">4</span></a>
            </ul>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;我的博客
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>
















<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
